<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Survival Kit - Future-Proof Your Career</title>
    <style>
        :root {
            /* WSI Brand Colors */
            --growth-green: #2E7D32;
            --growth-green-light: #4CAF50;
            --growth-green-dark: #1B5E20;
            --action-orange: #F57C00;
            --action-orange-light: #FF9800;
            --guidance-blue: #1976D2;
            --guidance-blue-light: #2196F3;
            --neutral-dark: #1F1F1F;
            --neutral-light: #F5F5F5;
            --card-bg: #2A2A2A;
            --danger-red: #D32F2F;
            --gold: #FFD700;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--neutral-dark);
            color: var(--neutral-light);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, var(--growth-green) 0%, var(--growth-green-light) 100%);
            padding: 40px 20px;
            text-align: center;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        header h1 { 
            margin: 0; 
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        header p { 
            margin: 10px 0 0; 
            font-size: 1.2rem; 
            font-weight: 500;
            opacity: 0.95;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* API Key Section */
        .api-config {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 40px;
            border: 2px solid var(--growth-green);
            text-align: center;
        }

        .api-config h3 {
            color: var(--growth-green-light);
        }

        input[type="password"] {
            padding: 12px;
            width: 320px;
            border-radius: 6px;
            border: 2px solid var(--growth-green);
            background: var(--neutral-dark);
            color: white;
            margin-right: 10px;
            font-size: 1rem;
        }

        input[type="password"]:focus {
            outline: none;
            border-color: var(--growth-green-light);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
        }

        button {
            padding: 12px 24px;
            border-radius: 6px;
            border: none;
            background: var(--growth-green);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        button:hover { 
            transform: scale(1.05); 
            background: var(--growth-green-light);
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.4);
        }

        /* Roles Grid */
        .roles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .role-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #444;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .role-card:hover {
            border-color: var(--growth-green);
            background: #353535;
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(46, 125, 50, 0.3);
        }

        .role-card h3 {
            color: var(--growth-green-light);
        }

        /* Quiz Section */
        #quiz-area {
            display: none;
            margin-top: 40px;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid var(--growth-green);
        }

        #quiz-title {
            color: var(--growth-green-light);
        }

        .quiz-question { margin-bottom: 25px; }
        .quiz-question p { margin-bottom: 12px; font-weight: bold; font-size: 1.1rem; }
        
        .options { display: flex; gap: 10px; flex-wrap: wrap; }
        .option-btn {
            background: var(--neutral-dark);
            border: 2px solid #444;
            color: white;
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option-btn:hover {
            border-color: var(--growth-green);
        }
        
        .option-btn.selected {
            background: var(--growth-green);
            border-color: var(--growth-green);
            color: white;
        }

        /* Results Area */
        #results-area {
            display: none;
            margin-top: 40px;
            background: var(--card-bg);
            padding: 35px;
            border-radius: 15px;
            border-left: 6px solid var(--growth-green);
        }

        #results-area h3 {
            color: var(--growth-green-light);
        }

        .risk-meter {
            height: 30px;
            background: var(--neutral-dark);
            border-radius: 15px;
            margin: 25px 0;
            overflow: hidden;
            border: 2px solid #444;
        }

        #risk-fill {
            height: 100%;
            width: 0%;
            transition: width 1.5s ease-in-out;
            background: linear-gradient(90deg, var(--growth-green), var(--action-orange), var(--danger-red));
        }

        #ai-tutorial {
            background: var(--neutral-dark);
            padding: 25px;
            border-radius: 12px;
            margin-top: 25px;
            white-space: pre-wrap;
            font-size: 1.1rem;
            border: 2px solid var(--growth-green);
            min-height: 100px;
            height: auto;
            display: block;
            overflow: visible;
            line-height: 1.8;
        }

        /* Action Buttons for Strategy */
        .strategy-actions {
            display: none;
            margin-top: 20px;
            text-align: center;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .strategy-actions button {
            background: var(--action-orange);
            margin: 5px;
        }

        .strategy-actions button:hover {
            background: var(--action-orange-light);
        }

        .copy-feedback {
            display: inline-block;
            margin-left: 10px;
            color: var(--growth-green-light);
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .copy-feedback.show {
            opacity: 1;
        }

        /* Saved Results Section */
        #saved-results-section {
            display: none;
            margin-top: 40px;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid var(--growth-green);
        }

        #saved-results-section h2 {
            color: var(--growth-green-light);
        }

        .saved-result-card {
            background: var(--neutral-dark);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid var(--growth-green);
            position: relative;
        }

        .saved-result-card h4 {
            margin-top: 0;
            color: var(--growth-green-light);
        }

        .saved-result-card .score {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--action-orange);
        }

        .saved-result-card .timestamp {
            font-size: 0.85rem;
            color: #888;
            margin-top: 10px;
        }

        .saved-result-card button {
            background: var(--guidance-blue);
            font-size: 0.9rem;
            padding: 8px 16px;
            margin-top: 10px;
            margin-right: 10px;
        }

        .saved-result-card button:hover {
            background: var(--guidance-blue-light);
        }

        .compare-mode {
            border: 2px solid var(--growth-green-light) !important;
            background: #2A3A2A !important;
        }

        /* Certificate Section */
        #certificate-section {
            display: none;
            text-align: center;
            margin-top: 60px;
            padding: 80px 40px;
            border-radius: 20px;
            border: 8px double var(--growth-green); 
            background: var(--card-bg);
            position: relative;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        #certificate-section h2 {
            color: var(--growth-green-light);
        }

        #cert-role {
            color: var(--growth-green-light);
        }

        /* Golden Badge CSS */
        .golden-badge {
            width: 140px;
            height: 140px;
            background: radial-gradient(circle, var(--gold), #b8860b) !important;
            border-radius: 50%;
            margin: 40px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--neutral-dark) !important;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            border: 5px solid var(--growth-green);
            position: relative;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .golden-badge::before, .golden-badge::after {
            content: '';
            position: absolute;
            width: 50px;
            height: 100px;
            background: #b8860b !important;
            bottom: -40px;
            z-index: -1;
            clip-path: polygon(0% 0%, 100% 0%, 50% 100%);
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .golden-badge::before { left: 15px; transform: rotate(15deg); }
        .golden-badge::after { right: 15px; transform: rotate(-15deg); }

        #graduation-section {
            display: none;
            text-align: center;
            margin-top: 60px;
            padding: 50px;
            border-radius: 15px;
            background: var(--card-bg); 
            border: 2px solid var(--growth-green);
        }

        #graduation-section h2 {
            color: var(--growth-green-light);
        }

        .download-btn {
            background: linear-gradient(135deg, var(--growth-green), var(--growth-green-light));
            color: white;
            font-size: 1.2rem;
            padding: 15px 35px;
            border-radius: 30px;
            margin: 20px 0;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(46, 125, 50, 0.4); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(46, 125, 50, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(46, 125, 50, 0); }
        }

        /* PRINT STYLES - FORCING COLOR */
        @media print {
            @page { size: portrait; margin: 0; }
            body { background: white !important; color: black !important; }
            header, .api-config, #roles, #quiz-area, #results-area, #graduation-section, button, .setup-guide, #saved-results-section {
                display: none !important;
            }
            .container { max-width: 100% !important; padding: 0 !important; margin: 0 !important; }
            #certificate-section {
                display: block !important;
                border: 15px double var(--growth-green) !important;
                background: var(--card-bg) !important; 
                color: white !important;
                padding: 150px 60px !important;
                margin: 0 !important;
                height: 100vh !important;
                width: 100vw !important;
                box-sizing: border-box !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            #certificate-section h2, #certificate-section span { color: var(--growth-green-light) !important; }
            .golden-badge { 
                background: radial-gradient(circle, var(--gold), #b8860b) !important; 
                border: 5px solid var(--growth-green) !important; 
                color: var(--neutral-dark) !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .golden-badge::before, .golden-badge::after { background: #b8860b !important; }
        }

        #typing { 
            font-style: italic; 
            color: var(--action-orange); 
            display: none; 
            margin-top: 15px; 
        }

        /* Link Styling */
        a {
            color: var(--growth-green-light);
            text-decoration: none;
        }

        a:hover {
            color: var(--action-orange);
            text-decoration: underline;
        }

        #key-status {
            color: var(--growth-green-light);
        }

        #risk-summary {
            color: var(--growth-green-light);
        }

        /* Accent elements using orange sparingly */
        .setup-guide h4 {
            color: var(--action-orange);
        }

        #cert-btn {
            background: var(--action-orange);
        }

        #cert-btn:hover {
            background: var(--action-orange-light);
        }
    </style>
</head>
<body>

    <header>
        <h1>üõ°Ô∏è AI Survival Kit</h1>
        <p>Future-Proof Your Career in the Age of AI</p>
    </header>

    <div class="container">
        
        <div class="api-config">
            <h3>üîê Secure Your Experience</h3>
            <p>Activate your kit with a free Gemini API Key to unlock personalized AI strategy.</p>
            <div class="api-input-group">
                <input type="password" id="web-api-key" placeholder="Paste Gemini API Key here">
                <button onclick="saveKey()">Activate My Kit</button>
            </div>
            <p id="key-status" style="font-size: 0.85rem; margin-top: 0;"></p>
            <div class="setup-guide">
                <h4>‚è±Ô∏è 1-Minute Setup Guide:</h4>
                <ol style="text-align: left; max-width: 500px; margin: 20px auto;">
                    <li>Visit <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>.</li>
                    <li>Click <b>"Create API key"</b> and copy it.</li>
                    <li>Paste it above to unlock your survival tools.</li>
                </ol>
            </div>
        </div>

        <section id="roles">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--growth-green-light);">1. Select Your Professional Field</h2>
            <div class="roles-grid">
                <div class="role-card" onclick="startQuiz('Customer Support')"><h3>üéß Support</h3><p>Service & Ops</p></div>
                <div class="role-card" onclick="startQuiz('Data Entry')"><h3>‚å®Ô∏è Data Entry</h3><p>Admin & Clerical</p></div>
                <div class="role-card" onclick="startQuiz('Copywriting')"><h3>‚úçÔ∏è Writing</h3><p>Content & Marketing</p></div>
                <div class="role-card" onclick="startQuiz('Graphic Design')"><h3>üé® Design</h3><p>Visual Arts</p></div>
                <div class="role-card" onclick="startQuiz('Accounting')"><h3>üìä Finance</h3><p>Bookkeeping</p></div>
                <div class="role-card" onclick="startQuiz('Legal Assistant')"><h3>‚öñÔ∏è Legal</h3><p>Research</p></div>
                <div class="role-card" onclick="startQuiz('Sales')"><h3>ü§ù Sales</h3><p>Relationships</p></div>
                <div class="role-card" onclick="startQuiz('Software Dev')"><h3>üíª Coding</h3><p>Development</p></div>
            </div>
        </section>

        <section id="quiz-area">
            <h2 id="quiz-title">Career Risk Assessment</h2>
            <div id="quiz-container"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="calculateResults()">Calculate My Survival Score</button>
            </div>
        </section>

        <section id="results-area">
            <h2 id="result-role-title">Assessment Results</h2>
            <div class="risk-meter"><div id="risk-fill"></div></div>
            <p id="risk-summary" style="font-size: 1.3rem; font-weight: bold; text-align: center;"></p>
            <hr style="border: 0; border-top: 1px solid #444; margin: 35px 0;">
            <h3>üéì Your Personalized AI Survival Strategy</h3>
            <p id="typing">Gemini AI is crafting your deep-dive strategy...</p>
            <div id="ai-tutorial">Your personalized strategy will appear here.</div>
            
            <!-- Action Buttons -->
            <div class="strategy-actions" id="strategy-actions" style="display: flex;">
                <button onclick="copyStrategy()">üìã Copy Strategy</button>
                <button onclick="saveResult()">üíæ Save Result</button>
                <button onclick="toggleSavedResults()">üìä View Saved Results</button>
                <span class="copy-feedback" id="copy-feedback">‚úì Copied!</span>
            </div>
            
            <div style="margin-top: 40px; text-align: center;">
                <button onclick="retakeAssessment()" style="background: var(--guidance-blue); margin-right: 10px;">üîÑ Test Another Role</button>
                <button id="cert-btn" style="display: none;" onclick="showCert()">I've Completed My Training</button>
            </div>
        </section>

        <!-- Saved Results Section -->
        <section id="saved-results-section">
            <h2>üìä Your Saved Assessment History</h2>
            <p style="color: #888; margin-bottom: 20px;">Compare your results across different roles to find your best career path.</p>
            <div id="saved-results-container"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="clearAllResults()" style="background: var(--danger-red);">üóëÔ∏è Clear All Results</button>
                <button onclick="toggleSavedResults()">‚Üê Back to Current Result</button>
            </div>
        </section>

        <section id="certificate-section">
            <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 20px;">CERTIFICATE OF AI ADAPTABILITY</div>
            <p style="font-size: 1.2rem;">This certifies that the user has successfully completed the</p>
            <h2 style="margin: 30px 0; font-size: 3rem;">AI SURVIVAL & EMPOWERMENT COURSE</h2>
            <p style="font-size: 1.2rem;">for the professional field of <br><span id="cert-role" style="font-weight: bold; font-size: 2rem;"></span></p>
            
            <div class="golden-badge">GRADUATE</div>
            
            <p style="margin-top: 60px; font-size: 1.1rem; opacity: 0.8;">Verified by AI Survival Kit | February 1, 2026</p>
            <button onclick="showGraduation()" style="margin-top: 30px; background: var(--action-orange);">Claim Your Graduation Reward</button>
        </section>

        <section id="graduation-section">
            <h2 style="font-size: 2.2rem;">üéì Mission Accomplished!</h2>
            <p style="font-size: 1.1rem; margin: 20px 0;">You are now equipped to lead in the age of AI. Take your assistant with you.</p>
            <button class="download-btn" onclick="handleDownload()">üöÄ Activate AI Survival Assistant</button>
            <div id="install-box" style="display:none; background: var(--neutral-dark); padding:25px; border-radius:12px; margin-top:20px; text-align:left; border: 2px solid var(--growth-green);">
                <h3 style="color: var(--action-orange); margin-top:0;">üõ†Ô∏è Next Step: One-Time Setup</h3>
                <p>The Assistant is already in your project folder! Just follow these 3 steps:</p>
                <ol>
                    <li>Go to <code>chrome://extensions</code> in Chrome.</li>
                    <li>Enable <b>Developer Mode</b> (top right).</li>
                    <li>Click <b>Load unpacked</b> and select the <code>chrome-extension</code> folder.</li>
                </ol>
            </div>
            <button onclick="window.print()" style="margin-top:30px; background: var(--guidance-blue); color: white;">üñ®Ô∏è Print Professional Full-Color Certificate</button>
        </section>

    </div>

    <script>
        let apiKey = localStorage.getItem('survival_kit_key') || '';
        let currentRole = '';
        let currentPercentage = 0;
        let currentStrategy = '';
        let scores = [0, 0, 0, 0, 0];
        const questions = [
            "How much of your work involves repetitive data entry?",
            "How often do you follow a strict set of rules or scripts?",
            "How much of your role involves predicting outcomes from past data?",
            "How often do you create standard documents or reports?",
            "How much of your time is spent on manual data gathering?"
        ];

        function saveKey() {
            const key = document.getElementById('web-api-key').value.trim();
            if(key) { 
                localStorage.setItem('survival_kit_key', key); 
                apiKey = key; 
                document.getElementById('key-status').innerText = "‚úÖ Kit Activated!"; 
            }
        }

        function startQuiz(role) {
            if(!apiKey) { alert("Please activate your Kit first!"); return; }
            currentRole = role;
            scores = [0, 0, 0, 0, 0];
            document.getElementById('roles').style.display = 'none';
            document.getElementById('quiz-area').style.display = 'block';
            document.getElementById('results-area').style.display = 'none';
            document.getElementById('saved-results-section').style.display = 'none';
            document.getElementById('certificate-section').style.display = 'none';
            document.getElementById('graduation-section').style.display = 'none';
            document.getElementById('quiz-title').innerText = `${role} Assessment`;
            const container = document.getElementById('quiz-container');
            container.innerHTML = questions.map((q, i) => `
                <div class="quiz-question"><p>${i+1}. ${q}</p><div class="options">
                ${[1, 2, 3, 4, 5].map(v => `<button class="option-btn q${i}" onclick="setScore(${i}, ${v}, this)">${v === 1 ? 'Little' : v === 5 ? 'All' : v}</button>`).join('')}
                </div></div>`).join('');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function setScore(qIdx, value, btn) {
            scores[qIdx] = value;
            document.querySelectorAll(`.q${qIdx}`).forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        }

        async function calculateResults() {
            if(scores.includes(0)) { alert("Please answer all questions!"); return; }
            const total = scores.reduce((a, b) => a + b, 0);
            const percentage = Math.round((total / 25) * 100);
            currentPercentage = percentage;
            
            document.getElementById('quiz-area').style.display = 'none';
            document.getElementById('results-area').style.display = 'block';
            document.getElementById('saved-results-section').style.display = 'none';
            
            setTimeout(() => { document.getElementById('risk-fill').style.width = percentage + '%'; }, 100);
            document.getElementById('risk-summary').innerText = `AI Automation Potential: ${percentage}%`;
            generateTutorial(percentage);
        }

        async function generateTutorial(percentage) {
            const tutorial = document.getElementById('ai-tutorial');
            const typing = document.getElementById('typing');
            const actions = document.getElementById('strategy-actions');
            
            typing.style.display = 'block';
            tutorial.innerText = "";
            actions.style.display = 'none';
            
            const userPrompt = `You are an expert AI Career Strategist providing advice on the "AI Survival Kit" platform.

Your task: Create a personalized, 3-part survival strategy for a user in the **${currentRole}** field who scored **${percentage}%** on their AI Automation Potential assessment.

Your response MUST be structured in three distinct, numbered paragraphs:

1. **Impact Analysis:** Start with a direct, one-sentence summary of what their score means. Then, explain *why* their role is susceptible to automation, mentioning 2-3 specific tasks that AI can now handle.

2. **AI Tool Mastery:** Recommend **one specific, real-world AI tool** that they should master. Explain what the tool does and how it can transform their role from one of simple execution to one of strategic oversight.

3. **Human Skill Focus:** Identify **one critical "human" skill** they should focus on developing (e.g., strategic thinking, complex problem-solving, client relationship management). Explain why this skill is difficult to automate and how it will become their key differentiator.

Ensure the entire response is complete, well-written, and provides actionable, empowering advice. MUST finish all sentences completely.`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userPrompt }] }],
                        generationConfig: { 
                            temperature: 0.7, 
                            maxOutputTokens: 4096,
                            topP: 0.95,
                            topK: 40
                        },
                        safetySettings: [
                            { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                            { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                            { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                            { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                        ]
                    })
                });
                
                const data = await response.json();
                typing.style.display = 'none';
                
                if(data.candidates && data.candidates[0].content) {
                    const text = data.candidates[0].content.parts[0].text;
                    currentStrategy = text;
                    tutorial.innerText = text;
                    actions.style.display = 'flex';
                    document.getElementById('cert-btn').style.display = 'inline-block';
                    document.getElementById('cert-role').innerText = currentRole;
                } else {
                    let errorMessage = "‚ö†Ô∏è The AI model did not return a valid response.\n\n";
                    errorMessage += "Possible reasons:\n";
                    errorMessage += "- API key might be invalid or exceeded quota\n";
                    errorMessage += "- Model temporarily unavailable\n";
                    errorMessage += "- Response blocked by safety filters\n\n";
                    errorMessage += "Please try again or verify your API key.";
                    tutorial.innerText = errorMessage;
                    console.error("AI Response Error:", JSON.stringify(data, null, 2));
                }
            } catch (e) { 
                typing.style.display = 'none'; 
                tutorial.innerText = "‚ùå Connection Error\n\nCould not connect to the Gemini API. Please check your internet connection and ensure your API key is correct and active."; 
                console.error("Fetch API Error:", e);
            }
        }

        function copyStrategy() {
            const strategy = document.getElementById('ai-tutorial').innerText;
            const feedback = document.getElementById('copy-feedback');
            
            navigator.clipboard.writeText(strategy).then(() => {
                feedback.classList.add('show');
                setTimeout(() => {
                    feedback.classList.remove('show');
                }, 2000);
            }).catch(err => {
                alert('Failed to copy: ' + err);
            });
        }

        function saveResult() {
            const savedResults = JSON.parse(localStorage.getItem('survival_kit_results') || '[]');
            
            const newResult = {
                id: Date.now(),
                role: currentRole,
                percentage: currentPercentage,
                strategy: currentStrategy,
                timestamp: new Date().toLocaleString(),
                scores: [...scores]
            };
            
            savedResults.push(newResult);
            localStorage.setItem('survival_kit_results', JSON.stringify(savedResults));
            
            alert(`‚úÖ Result saved for ${currentRole} (${currentPercentage}%)`);
        }

        function toggleSavedResults() {
            const resultsSection = document.getElementById('saved-results-section');
            const currentSection = document.getElementById('results-area');
            
            if(resultsSection.style.display === 'none' || resultsSection.style.display === '') {
                displaySavedResults();
                resultsSection.style.display = 'block';
                currentSection.style.display = 'none';
            } else {
                resultsSection.style.display = 'none';
                currentSection.style.display = 'block';
            }
        }

        function displaySavedResults() {
            const savedResults = JSON.parse(localStorage.getItem('survival_kit_results') || '[]');
            const container = document.getElementById('saved-results-container');
            
            if(savedResults.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888;">No saved results yet. Complete an assessment and click "Save Result" to start tracking your progress.</p>';
                return;
            }
            
            savedResults.sort((a, b) => b.id - a.id);
            
            container.innerHTML = savedResults.map((result, index) => `
                <div class="saved-result-card" id="result-${result.id}">
                    <h4>${result.role}</h4>
                    <div class="score">AI Automation Potential: ${result.percentage}%</div>
                    <div class="timestamp">Assessed on: ${result.timestamp}</div>
                    <div style="margin-top: 15px;">
                        <button onclick="viewStrategy(${result.id})">üëÅÔ∏è View Strategy</button>
                        <button onclick="copyStrategyById(${result.id})">üìã Copy</button>
                        <button onclick="completeTrainingFor(${result.id})" style="background: var(--action-orange);">üéì Complete Training</button>
                        <button onclick="deleteResult(${result.id})" style="background: var(--danger-red);">üóëÔ∏è Delete</button>
                    </div>
                    <div id="strategy-${result.id}" style="display: none; margin-top: 15px; padding: 15px; background: var(--neutral-dark); border-radius: 8px; white-space: pre-wrap; font-size: 0.95rem; line-height: 1.6; border: 1px solid var(--growth-green);"></div>
                </div>
            `).join('');
        }

        function viewStrategy(id) {
            const savedResults = JSON.parse(localStorage.getItem('survival_kit_results') || '[]');
            const result = savedResults.find(r => r.id === id);
            const strategyDiv = document.getElementById(`strategy-${id}`);
            
            if(strategyDiv.style.display === 'none') {
                strategyDiv.innerText = result.strategy;
                strategyDiv.style.display = 'block';
            } else {
                strategyDiv.style.display = 'none';
            }
        }

        function copyStrategyById(id) {
            const savedResults = JSON.parse(localStorage.getItem('survival_kit_results') || '[]');
            const result = savedResults.find(r => r.id === id);
            
            navigator.clipboard.writeText(result.strategy).then(() => {
                alert('‚úì Strategy copied to clipboard!');
            }).catch(err => {
                alert('Failed to copy: ' + err);
            });
        }

        function deleteResult(id) {
            if(!confirm('Are you sure you want to delete this result?')) return;
            
            let savedResults = JSON.parse(localStorage.getItem('survival_kit_results') || '[]');
            savedResults = savedResults.filter(r => r.id !== id);
            localStorage.setItem('survival_kit_results', JSON.stringify(savedResults));
            
            displaySavedResults();
        }

        function clearAllResults() {
            if(!confirm('Are you sure you want to delete ALL saved results? This cannot be undone.')) return;
            
            localStorage.removeItem('survival_kit_results');
            displaySavedResults();
        }

        function handleDownload() {
            document.getElementById('install-box').style.display = 'block';
            alert("The AI Assistant is ready in your project folder! Follow the 3 steps below to install it.");
        }

        function showCert() { 
            document.getElementById('certificate-section').style.display = 'block'; 
            document.getElementById('certificate-section').scrollIntoView({ behavior: 'smooth' }); 
        }
        
        function showGraduation() { 
            document.getElementById('graduation-section').style.display = 'block'; 
            document.getElementById('graduation-section').scrollIntoView({ behavior: 'smooth' }); 
        }

        function retakeAssessment() {
            document.getElementById('roles').style.display = 'block';
            document.getElementById('quiz-area').style.display = 'none';
            document.getElementById('results-area').style.display = 'none';
            document.getElementById('saved-results-section').style.display = 'none';
            document.getElementById('certificate-section').style.display = 'none';
            document.getElementById('graduation-section').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function completeTrainingFor(id) {
            const savedResults = JSON.parse(localStorage.getItem('survival_kit_results') || '[]');
            const result = savedResults.find(r => r.id === id);
            
            if(!result) {
                alert('Result not found!');
                return;
            }
            
            // Set the current role for certificate
            currentRole = result.role;
            currentPercentage = result.percentage;
            currentStrategy = result.strategy;
            
            // Update certificate with selected role
            document.getElementById('cert-role').innerText = currentRole;
            
            // Show certificate section
            document.getElementById('saved-results-section').style.display = 'none';
            document.getElementById('certificate-section').style.display = 'block';
            document.getElementById('certificate-section').scrollIntoView({ behavior: 'smooth' });
        }

        window.addEventListener('DOMContentLoaded', () => {
            if(apiKey) {
                document.getElementById('key-status').innerText = "‚úÖ Kit Activated!";
            }
        });
    </script>
</body>
</html>
